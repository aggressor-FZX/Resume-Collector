name: Validate Formatter

on:
  pull_request:
  workflow_dispatch:

jobs:
  format-validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: |
          npm ci || true

      - name: Run formatter on sample data (TypeScript)
        run: |
          npx ts-node scripts/format-for-llm.ts --input training-data/raw/sample.json --output training-data/formatted/sample.jsonl --format openai

      - name: Run tests
        run: |
          npm test --silent

      - name: Validate JSONL
        run: |
          python - <<'PY'
import sys,json
p='training-data/formatted/sample.jsonl'
with open(p,'r') as f:
    for i,line in enumerate(f,1):
        try:
            json.loads(line)
        except Exception as e:
            print(f"Invalid JSONL at line {i}: {e}")
            sys.exit(1)
print('âœ… sample.jsonl is valid')
PY
